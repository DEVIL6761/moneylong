<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Учет финансов</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <form id="mainForm" method="post" action="">
            <h1><i class="fas fa-wallet"></i> Учет финансов</h1>

            <!-- Счета -->
            <div class="section-header">
                <h2><i class="fas fa-coins"></i> Счета</h2>
            </div>

            <div class="total-balance">
                Общий баланс: <span class="amount">{{ "%.2f"|format(total_balance) }} BYN</span>
            </div>



            <!-- Операции -->
            <div class="operations-section">
                <div class="transaction-form full-width">
                    <div class="accounts-list">
                {% for account in accounts %}
                <div class="account-card form-input">
                    <h3>{{ account.name }}</h3>
                    <div class="account-balance">{{ "%.2f"|format(account.balance) }} {{ account.currency }}</div>
                    <div class="account-description">{{ account.description or '' }}</div>
                    <button type="button" class="delete-account-btn" data-id="{{ account.id }}" title="Удалить счет" onclick="deleteAccount(this)">
    <i class="fas fa-times"></i>
</button>
                </div>
                {% endfor %}
            </div>

            <!-- Кнопка добавления счета -->
            <button type="button" class="btn form-input" id="addAccountBtn">
    <i class="fas fa-plus"></i> Добавить счет
</button>
                    <h2><i class="fas fa-plus-circle"></i> Добавить операцию</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Счет:</label>
                            <div class="custom-select">
                                <select name="account" required class="form-input">
                                    <option value="">Выберите счет</option>
                                    {% for account in accounts %}
                                    <option value="{{ account.id }}">{{ account.name }} ({{ "%.2f"|format(account.balance) }} {{ account.currency }})</option>
                                    {% endfor %}
                                </select>
                                <span class="select-arrow"><i class="fas fa-chevron-down"></i></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Тип:</label>
                            <select name="type" required class="form-input">
                                <option value="income">Доход</option>
                                <option value="expense">Расход</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Сумма (BYN):</label>
                            <input type="text" name="amount" class="form-input" inputmode="decimal" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Категория:</label>
                            <div class="custom-select">
                                <select name="category" required class="form-input">
                                    <option value="" disabled selected>Выберите категорию</option>
                                    {% for cat in categories if cat['name'] != '+ Новая категория' %}
                                    <option value="{{ cat['name'] }}" data-type="{{ cat['type'] }}">{{ cat['name'] }}</option>
                                    {% endfor %}
                                </select>
                                <span class="select-arrow"><i class="fas fa-chevron-down"></i></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Дата:</label>
                            <input type="date" name="date" class="form-input">
                        </div>

                        <div class="form-group">
                            <label>Описание:</label>
                            <input type="text" name="description" class="form-input">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn form-input" name="action" value="add_transaction">
                            <i class="fas fa-save"></i> Добавить операцию
                        </button>
                    </div>

                    <!-- Кнопки аналитики и истории -->
                    <div class="form-buttons-row">
    <a href="{{ url_for('analytics') }}" class="btn btn-secondary form-input">
        <i class="fas fa-chart-pie"></i> Аналитика
    </a>
    <a href="{{ url_for('history') }}" class="btn btn-secondary form-input">
    <i class="fas fa-list"></i> История операций
</a>
</div>



            <!-- Скрытые поля для действий -->
            <input type="hidden" name="action" id="actionType" value="">
            <input type="hidden" name="target_id" id="targetId" value="">
        </form>

        <!-- Модальное окно для счета -->
        <div id="accountModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Добавить новый счет</h2>
                <form onsubmit="event.preventDefault(); addAccount();">
                    <div class="form-group">
                        <label>Название счета:</label>
                        <input type="text" id="accountName" required>
                    </div>
                    <div class="form-group">
                        <label>Начальный баланс:</label>
                        <input type="number" step="0.01" id="initialBalance" value="0">
                    </div>
                    <div class="form-group">
                        <label>Валюта:</label>
                        <select id="accountCurrency">
                            <option value="BYN">BYN</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="RUB">RUB</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Описание (необязательно):</label>
                        <textarea id="accountDescription"></textarea>
                    </div>
                    <button type="submit" class="btn form-input">Сохранить</button>
                </form>
            </div>
        </div>

        <!-- Flash-сообщения -->
        <div class="flash-container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message {{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>